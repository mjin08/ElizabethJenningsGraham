{"ast":null,"code":"var _jsxFileName = \"/Users/maggiejin/cse495/lizzie-graham/src/screens/PlayerWindow.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\n\n// Import bundled idle assets (these files exist in the project)\nimport idle1 from '../assets/idle/idle1.mp4';\nimport idle2 from '../assets/idle/idle2.mp4';\nimport idle3 from '../assets/idle/idle3.mp4';\nimport idle4 from '../assets/idle/idle4.mp4';\n\n// Import only the answer file that was uploaded\nimport whoAreYou from '../assets/answers/who_are_you.mp4';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst idleVideos = [idle1, idle2, idle3, idle4].filter(Boolean);\nexport default function PlayerWindow() {\n  _s();\n  const videoRef = useRef(null);\n  const [src, setSrc] = useState(idleVideos.length ? idleVideos[Math.floor(Math.random() * idleVideos.length)] : '');\n  const intervalRef = useRef(null);\n  useEffect(() => {\n    let mounted = true;\n    function startIdleRotation() {\n      if (intervalRef.current) clearInterval(intervalRef.current);\n      if (!idleVideos.length) return;\n      intervalRef.current = setInterval(() => {\n        if (!mounted) return;\n        const next = idleVideos[Math.floor(Math.random() * idleVideos.length)];\n        setSrc(next);\n      }, 7000);\n    }\n    function stopIdleRotation() {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    }\n\n    // start rotation\n    startIdleRotation();\n\n    // Listen for broadcast messages to play answer\n    let ch;\n    if ('BroadcastChannel' in window) {\n      ch = new BroadcastChannel('graham-player-channel');\n      ch.onmessage = ev => {\n        const data = ev.data;\n        if (!data) return;\n        if (data.type === 'playAnswer' && data.questionId) {\n          // Only play if we have a file for that questionId; otherwise ignore\n          // Currently, only `who_are_you` is available for spoken queries; click-based questionIds are not mapped here.\n          // If you later upload answer files named to match question ids, add them here.\n          console.log('Received playAnswer for', data.questionId);\n          // No mapped click-answer files are present; ignore unknown IDs.\n        }\n        if (data.type === 'playAnswerSpoken' && data.text) {\n          const text = (data.text || '').toLowerCase();\n          if (text.includes('who are you') || text.includes(\"who're you\") || text.includes(\"who r u\")) {\n            if (whoAreYou) playAnswerOnce(whoAreYou);\n            return;\n          }\n          // fallback: no semantic matching implemented here\n        }\n        if (data.type === 'ping') {\n          // no-op: ensure player is awake\n        }\n      };\n    } else {\n      // fallback: listen to storage events\n      const storageHandler = ev => {\n        if (ev.key === 'graham-player-msg' && ev.newValue) {\n          try {\n            const data = JSON.parse(ev.newValue);\n            if (data.type === 'playAnswerSpoken' && data.text) {\n              const text = (data.text || '').toLowerCase();\n              if (text.includes('who are you')) {\n                if (whoAreYou) playAnswerOnce(whoAreYou);\n              }\n            }\n          } catch (e) {}\n        }\n      };\n      window.addEventListener('storage', storageHandler);\n    }\n    function playAnswerOnce(answerSrc) {\n      if (!answerSrc) return;\n      stopIdleRotation();\n\n      // set to answer and ensure it plays once (no loop)\n      setSrc(answerSrc);\n\n      // attach ended handler\n      const onEnded = () => {\n        // resume idle rotation after short delay\n        setTimeout(() => {\n          if (!mounted) return;\n          const next = idleVideos.length ? idleVideos[Math.floor(Math.random() * idleVideos.length)] : '';\n          setSrc(next);\n          startIdleRotation();\n        }, 800);\n        if (videoRef.current) videoRef.current.removeEventListener('ended', onEnded);\n      };\n\n      // ensure handler is attached when video element updates\n      setTimeout(() => {\n        if (videoRef.current) {\n          videoRef.current.loop = false;\n          videoRef.current.addEventListener('ended', onEnded);\n          const p = videoRef.current.play();\n          if (p && p.catch) p.catch(() => {/* autoplay blocked */});\n        }\n      }, 200);\n    }\n    return () => {\n      mounted = false;\n      if (intervalRef.current) clearInterval(intervalRef.current);\n      if (ch) ch.close();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-wrap\",\n    style: {\n      height: '100vh',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    children: src ? /*#__PURE__*/_jsxDEV(\"video\", {\n      src: src,\n      autoPlay: true,\n      muted: false,\n      ref: videoRef,\n      style: {\n        width: '100%',\n        height: '100%',\n        objectFit: 'cover'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: '#fff',\n        padding: 20\n      },\n      children: \"No video available \\u2014 add idle and answer videos to src/assets/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n}\n_s(PlayerWindow, \"h8h/lim+DfbkfVhRQ7OjcXjA5qs=\");\n_c = PlayerWindow;\nvar _c;\n$RefreshReg$(_c, \"PlayerWindow\");","map":{"version":3,"names":["React","useEffect","useRef","useState","idle1","idle2","idle3","idle4","whoAreYou","jsxDEV","_jsxDEV","idleVideos","filter","Boolean","PlayerWindow","_s","videoRef","src","setSrc","length","Math","floor","random","intervalRef","mounted","startIdleRotation","current","clearInterval","setInterval","next","stopIdleRotation","ch","window","BroadcastChannel","onmessage","ev","data","type","questionId","console","log","text","toLowerCase","includes","playAnswerOnce","storageHandler","key","newValue","JSON","parse","e","addEventListener","answerSrc","onEnded","setTimeout","removeEventListener","loop","p","play","catch","close","className","style","height","display","alignItems","justifyContent","children","autoPlay","muted","ref","width","objectFit","fileName","_jsxFileName","lineNumber","columnNumber","color","padding","_c","$RefreshReg$"],"sources":["/Users/maggiejin/cse495/lizzie-graham/src/screens/PlayerWindow.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\n// Import bundled idle assets (these files exist in the project)\nimport idle1 from '../assets/idle/idle1.mp4';\nimport idle2 from '../assets/idle/idle2.mp4';\nimport idle3 from '../assets/idle/idle3.mp4';\nimport idle4 from '../assets/idle/idle4.mp4';\n\n// Import only the answer file that was uploaded\nimport whoAreYou from '../assets/answers/who_are_you.mp4';\n\nconst idleVideos = [idle1, idle2, idle3, idle4].filter(Boolean);\n\nexport default function PlayerWindow() {\n  const videoRef = useRef(null);\n  const [src, setSrc] = useState(idleVideos.length ? idleVideos[Math.floor(Math.random() * idleVideos.length)] : '');\n  const intervalRef = useRef(null);\n\n  useEffect(() => {\n    let mounted = true;\n\n    function startIdleRotation() {\n      if (intervalRef.current) clearInterval(intervalRef.current);\n      if (!idleVideos.length) return;\n      intervalRef.current = setInterval(() => {\n        if (!mounted) return;\n        const next = idleVideos[Math.floor(Math.random() * idleVideos.length)];\n        setSrc(next);\n      }, 7000);\n    }\n\n    function stopIdleRotation() {\n      if (intervalRef.current) { clearInterval(intervalRef.current); intervalRef.current = null; }\n    }\n\n    // start rotation\n    startIdleRotation();\n\n    // Listen for broadcast messages to play answer\n    let ch;\n    if ('BroadcastChannel' in window) {\n      ch = new BroadcastChannel('graham-player-channel');\n      ch.onmessage = (ev) => {\n        const data = ev.data;\n        if (!data) return;\n\n        if (data.type === 'playAnswer' && data.questionId) {\n          // Only play if we have a file for that questionId; otherwise ignore\n          // Currently, only `who_are_you` is available for spoken queries; click-based questionIds are not mapped here.\n          // If you later upload answer files named to match question ids, add them here.\n          console.log('Received playAnswer for', data.questionId);\n          // No mapped click-answer files are present; ignore unknown IDs.\n        }\n\n        if (data.type === 'playAnswerSpoken' && data.text) {\n          const text = (data.text || '').toLowerCase();\n          if (text.includes('who are you') || text.includes(\"who're you\") || text.includes(\"who r u\")) {\n            if (whoAreYou) playAnswerOnce(whoAreYou);\n            return;\n          }\n          // fallback: no semantic matching implemented here\n        }\n\n        if (data.type === 'ping') {\n          // no-op: ensure player is awake\n        }\n      };\n    } else {\n      // fallback: listen to storage events\n      const storageHandler = (ev) => {\n        if (ev.key === 'graham-player-msg' && ev.newValue) {\n          try {\n            const data = JSON.parse(ev.newValue);\n            if (data.type === 'playAnswerSpoken' && data.text) {\n              const text = (data.text || '').toLowerCase();\n              if (text.includes('who are you')) {\n                if (whoAreYou) playAnswerOnce(whoAreYou);\n              }\n            }\n          } catch (e) {}\n        }\n      };\n      window.addEventListener('storage', storageHandler);\n    }\n\n    function playAnswerOnce(answerSrc) {\n      if (!answerSrc) return;\n      stopIdleRotation();\n\n      // set to answer and ensure it plays once (no loop)\n      setSrc(answerSrc);\n\n      // attach ended handler\n      const onEnded = () => {\n        // resume idle rotation after short delay\n        setTimeout(() => {\n          if (!mounted) return;\n          const next = idleVideos.length ? idleVideos[Math.floor(Math.random() * idleVideos.length)] : '';\n          setSrc(next);\n          startIdleRotation();\n        }, 800);\n\n        if (videoRef.current) videoRef.current.removeEventListener('ended', onEnded);\n      };\n\n      // ensure handler is attached when video element updates\n      setTimeout(() => {\n        if (videoRef.current) {\n          videoRef.current.loop = false;\n          videoRef.current.addEventListener('ended', onEnded);\n          const p = videoRef.current.play();\n          if (p && p.catch) p.catch(() => { /* autoplay blocked */ });\n        }\n      }, 200);\n    }\n\n    return () => { mounted = false; if (intervalRef.current) clearInterval(intervalRef.current); if (ch) ch.close(); };\n  }, []);\n\n  return (\n    <div className=\"video-wrap\" style={{height:'100vh',display:'flex',alignItems:'center',justifyContent:'center'}}>\n      {src ? (\n        <video src={src} autoPlay muted={false} ref={videoRef} style={{width:'100%',height:'100%',objectFit:'cover'}} />\n      ) : (\n        <div style={{color:'#fff',padding:20}}>No video available â€” add idle and answer videos to src/assets/</div>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}